%{
A=@(i) dt.*[ 1/dt, 0, - Y_ref(5,i)*cos(Y_ref(3,i)) - Y_ref(4,i)*sin(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                                                                  cos(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                       -sin(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                                       0;
0, 1/dt,   Y_ref(4,i)*cos(Y_ref(3,i)) - Y_ref(5,i)*sin(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                                                                  sin(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                        cos(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                                       0;
0, 0,                             1/dt,                                                                                                                                                                                                                                                                                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                                                                                                                                                                       1;
0, 0,                             0,  1/dt - (175*U_ref(2,i))/1573 - (343*Y_ref(4,i))/503360 - (636251507427115*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i))*((27*Y_ref(6,i))/20 + Y_ref(5,i)))/(4157528342528*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((27*Y_ref(6,i))/20 + Y_ref(5,i))^2 + Y_ref(4,i)^2)),                                                                                                                                                                   Y_ref(6,i) + (636251507427115*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i)))/(4157528342528*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((27*Y_ref(6,i))/20 + Y_ref(5,i))^2 + Y_ref(4,i)^2)),                                                                                                                                                                           Y_ref(5,i) + (3435758140106421*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i)))/(16630113370112*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((27*Y_ref(6,i))/20 + Y_ref(5,i))^2 + Y_ref(4,i)^2));
0, 0,                             0, - Y_ref(6,i) - (636251507427115*cos(2*atan(13*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i))))*((27*Y_ref(6,i))/20 - Y_ref(5,i)))/(4157528342528*(((27*Y_ref(6,i))/20 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) + (636251507427115*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i))*((27*Y_ref(6,i))/20 + Y_ref(5,i)))/(4157528342528*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((27*Y_ref(6,i))/20 + Y_ref(5,i))^2 + Y_ref(4,i)^2)), 1/dt  - (636251507427115*Y_ref(4,i)*cos(2*atan(13*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i)))))/(4157528342528*(((27*Y_ref(6,i))/20 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) - (636251507427115*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(4157528342528*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((27*Y_ref(6,i))/20 + Y_ref(5,i))^2 + Y_ref(4,i)^2)), - Y_ref(4,i) + (3435758140106421*Y_ref(4,i)*cos(2*atan(13*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i)))))/(16630113370112*(((27*Y_ref(6,i))/20 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) - (3435758140106421*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(16630113370112*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((27*Y_ref(6,i))/20 + Y_ref(5,i))^2 + Y_ref(4,i)^2));
0, 0,                             0,       (3435758140106421*cos(2*atan(13*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i))))*((27*Y_ref(6,i))/20 - Y_ref(5,i)))/(30374008717312*(((27*Y_ref(6,i))/20 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) + (3435758140106421*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i))*((27*Y_ref(6,i))/20 + Y_ref(5,i)))/(30374008717312*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((27*Y_ref(6,i))/20 + Y_ref(5,i))^2 + Y_ref(4,i)^2)), (3435758140106421*Y_ref(4,i)*cos(2*atan(13*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i)))))/(30374008717312*(((27*Y_ref(6,i))/20 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) - (3435758140106421*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(30374008717312*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((27*Y_ref(6,i))/20 + Y_ref(5,i))^2 + Y_ref(4,i)^2)), 1/dt  - (92765469782873367*Y_ref(4,i)*cos(2*atan(13*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i)))))/(607480174346240*(((27*Y_ref(6,i))/20 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((27*Y_ref(6,i))/20 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) - (92765469782873367*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(607480174346240*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((27*Y_ref(6,i))/20 + Y_ref(5,i))^2 + Y_ref(4,i)^2))];
 

B=@(i) dt.*[                                                                                                                                                                                                                                                                                                 0,0;
                                                                                                                                                                                                                                                                                                 0,0;
                                                                                                                                                                                                                                                                                                 0,0;
     - (636251507427115*sin(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/108095736905728 - (636251507427115*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i)))/(4157528342528*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)),11 - (175*Y_ref(4,i))/1573;
     -(636251507427115*sin(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i)))/108095736905728 - (636251507427115*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(4157528342528*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)),0;
  - (3435758140106421*sin(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i)))/789724226650112 + (3435758140106421*cos(2*atan(13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(30374008717312*((13*U_ref(1,i) - 13*atan2((27*Y_ref(6,i))/20 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)),0];
%} 
A=@(i) dt.*[ 1/dt, 0, - Y_ref(5,i)*cos(Y_ref(3,i)) - Y_ref(4,i)*sin(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                                                              cos(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                         -sin(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                                       0;
 0, 1/dt,   Y_ref(4,i)*cos(Y_ref(3,i)) - Y_ref(5,i)*sin(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                                                              sin(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                          cos(Y_ref(3,i)),                                                                                                                                                                                                                                                                                                                                                                                       0;
 0, 0,                             1/dt,                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                       1;
 0, 0,                             0, 1/dt                                                                                                                                                              - (7*U_ref(2,i))/60 - (343*Y_ref(4,i))/480000 - (944005620442391*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i))*((57*Y_ref(6,i))/50 + Y_ref(5,i)))/(6871947673600*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((57*Y_ref(6,i))/50 + Y_ref(5,i))^2 + Y_ref(4,i)^2)),                                                                                                                                                                     Y_ref(6,i) + (944005620442391*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i)))/(6871947673600*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((57*Y_ref(6,i))/50 + Y_ref(5,i))^2 + Y_ref(4,i)^2)),                                                                                                                                                                         Y_ref(5,i) + (53808320365216287*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i)))/(343597383680000*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((57*Y_ref(6,i))/50 + Y_ref(5,i))^2 + Y_ref(4,i)^2));
 0, 0,                             0, - Y_ref(6,i) - (69558308874702479*cos(2*atan(13*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i))))*((7*Y_ref(6,i))/5 - Y_ref(5,i)))/(412316860416000*(((7*Y_ref(6,i))/5 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) + (944005620442391*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i))*((57*Y_ref(6,i))/50 + Y_ref(5,i)))/(6871947673600*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((57*Y_ref(6,i))/50 + Y_ref(5,i))^2 + Y_ref(4,i)^2)),       - (69558308874702479*Y_ref(4,i)*cos(2*atan(13*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i)))))/(412316860416000*(((7*Y_ref(6,i))/5 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) - (944005620442391*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(6871947673600*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((57*Y_ref(6,i))/50 + Y_ref(5,i))^2 + Y_ref(4,i)^2))+1/dt, - Y_ref(4,i) + (486908162122917353*Y_ref(4,i)*cos(2*atan(13*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i)))))/(2061584302080000*(((7*Y_ref(6,i))/5 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) - (53808320365216287*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(343597383680000*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((57*Y_ref(6,i))/50 + Y_ref(5,i))^2 + Y_ref(4,i)^2));
 0, 0,                             0,   (486908162122917353*cos(2*atan(13*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i))))*((7*Y_ref(6,i))/5 - Y_ref(5,i)))/(3326022674022400*(((7*Y_ref(6,i))/5 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) + (161424961095648861*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i))*((57*Y_ref(6,i))/50 + Y_ref(5,i)))/(1663011337011200*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((57*Y_ref(6,i))/50 + Y_ref(5,i))^2 + Y_ref(4,i)^2)), (486908162122917353*Y_ref(4,i)*cos(2*atan(13*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i)))))/(3326022674022400*(((7*Y_ref(6,i))/5 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) - (161424961095648861*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(1663011337011200*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((57*Y_ref(6,i))/50 + Y_ref(5,i))^2 + Y_ref(4,i)^2)), - (3408357134860421471*Y_ref(4,i)*cos(2*atan(13*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i)))))/(16630113370112000*(((7*Y_ref(6,i))/5 - Y_ref(5,i))^2 + Y_ref(4,i)^2)*(169*atan2((7*Y_ref(6,i))/5 - Y_ref(5,i), Y_ref(4,i))^2 + 1)) - (9201222782451985077*Y_ref(4,i)*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(83150566850560000*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1)*(((57*Y_ref(6,i))/50 + Y_ref(5,i))^2 + Y_ref(4,i)^2))+1/dt]
 
B=@(i) dt.* [                       0,                                                                                                                                                                                                                                                                                    0;
                       0,                                                                                                                                                                                                                                                                                    0;
                       0,                                                                                                                                                                                                                                                                                    0;
 17303/1500 - (7*Y_ref(4,i))/60,            - (72615816957107*sin(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/13743895347200 - (944005620442391*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i)))/(6871947673600*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1));
                       0,            - (72615816957107*sin(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i)))/13743895347200 + (944005620442391*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(6871947673600*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1));
                       0, - (12417304699665297*sin(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*sin(U_ref(1,i)))/3326022674022400 + (161424961095648861*cos(2*atan(13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i))))*cos(U_ref(1,i)))/(1663011337011200*((13*U_ref(1,i) - 13*atan2((57*Y_ref(6,i))/50 + Y_ref(5,i), Y_ref(4,i)))^2 + 1))]
